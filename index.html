<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#00695c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Medici√≥n de Alturas con C√°mara v1.0</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üì∑ Medici√≥n con C√°mara</h1>
            <span class="version">v1.0</span>
        </header>

        <!-- Informaci√≥n del Lote -->
        <div class="form-section">
            <h2>Informaci√≥n del Lote</h2>
            
            <div class="form-group">
                <label for="lote">Nombre del Lote</label>
                <input type="text" id="lote" placeholder="Ej: Bosque Norte">
            </div>

            <div class="lote-actions">
                <button id="btnNuevoLote" class="btn btn-primary">
                    üìÇ Nuevo Lote
                </button>
                <button id="btnAbrirLote" class="btn btn-info">
                    üìÅ Abrir Lote Guardado
                </button>
            </div>

            <!-- Lista de lotes guardados (oculta inicialmente) -->
            <div id="lotesGuardados" class="lotes-list" style="display:none;"></div>
        </div>

        <!-- Configuraci√≥n de Medici√≥n -->
        <div class="form-section">
            <h2>Configuraci√≥n de Medici√≥n</h2>
            
            <div class="config-grid">
                <div class="form-group">
                    <label for="numeroArbol">N√∫mero de √Årbol</label>
                    <input type="number" id="numeroArbol" value="1" min="1">
                </div>

                <div class="form-group">
                    <label for="tipoMedicion">Tipo de Medici√≥n</label>
                    <select id="tipoMedicion">
                        <option value="India">India</option>
                        <option value="265">265</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="distancia">Distancia al √Årbol (metros)</label>
                <select id="distancia">
                    <option value="10">10 metros</option>
                    <option value="11">11 metros</option>
                    <option value="12">12 metros</option>
                    <option value="13">13 metros</option>
                    <option value="14">14 metros</option>
                    <option value="15" selected>15 metros</option>
                    <option value="16">16 metros</option>
                    <option value="17">17 metros</option>
                    <option value="18">18 metros</option>
                    <option value="19">19 metros</option>
                    <option value="20">20 metros</option>
                </select>
            </div>

            <!-- Estado actual -->
            <div class="current-status">
                <span>√Årbol: <strong id="statusArbol">1</strong></span>
                <span>Tipo: <strong id="statusTipo">India</strong></span>
                <span>Distancia: <strong id="statusDistancia">15m</strong></span>
                <span>Segmentos: <strong id="statusSegmentos">0</strong></span>
            </div>
        </div>

        <!-- Modo de Medici√≥n -->
        <div class="form-section">
            <h2>Modo de Medici√≥n</h2>
            
            <div class="measurement-mode">
                <button id="btnMedirCamara" class="btn btn-camera">
                    üì∑ Medir con C√°mara
                </button>
                
                <div class="divider">O</div>
                
                <button id="btnMedirManual" class="btn btn-manual">
                    ‚úèÔ∏è Entrada Manual
                </button>
            </div>

            <!-- Vista de C√°mara (oculta inicialmente) -->
            <div id="cameraView" class="camera-container" style="display:none;">
                <video id="videoElement" autoplay playsinline></video>
                <canvas id="canvasOverlay"></canvas>
                
                <div class="camera-controls">
                    <div class="angle-display">
                        <span>√Ångulo: <strong id="angleValue">0.0¬∞</strong></span>
                        <span>Altura: <strong id="heightValue">0.00m</strong></span>
                    </div>
                    
                    <div class="camera-buttons">
                        <button id="btnCalibrar" class="btn btn-warning">
                            üéØ Calibrar Base (0¬∞)
                        </button>
                        <button id="btnCapturar" class="btn btn-success">
                            üì∏ Capturar Segmento
                        </button>
                        <button id="btnCerrarCamara" class="btn btn-danger">
                            ‚ùå Cerrar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Entrada Manual (oculta inicialmente) -->
            <div id="manualEntry" class="manual-entry" style="display:none;">
                <div class="input-row">
                    <div class="form-group">
                        <label for="numeroSegmento">Segmento N¬∞</label>
                        <input type="number" id="numeroSegmento" value="1" readonly>
                    </div>
                    <div class="form-group">
                        <label for="altura">Altura Acumulada (m)</label>
                        <input type="number" id="altura" placeholder="Ej: 3.26" step="0.01" min="0">
                    </div>
                </div>
                
                <button id="btnAgregarSegmento" class="btn btn-primary">
                    ‚ûï Agregar Segmento
                </button>
                
                <button id="btnCerrarManual" class="btn btn-secondary">
                    ‚Ü©Ô∏è Volver
                </button>
            </div>
        </div>

        <!-- Lista de Segmentos -->
        <div class="form-section">
            <h2>Segmentos Capturados</h2>
            
            <div id="listaSegmentos" class="segments-list">
                <p class="empty-message">No hay segmentos capturados</p>
            </div>

            <!-- Botones de guardado -->
            <div class="save-actions">
                <button id="btnGuardarMedicion" class="btn btn-success">
                    üíæ Guardar √Årbol/Tipo/Segmentos
                </button>
                <button id="btnSiguienteArbol" class="btn btn-warning" style="display:none;">
                    ‚û°Ô∏è Siguiente √Årbol
                </button>
            </div>
        </div>

        <!-- Resumen del Lote -->
        <div class="form-section">
            <h2>Resumen del Lote</h2>
            <div id="resumenLote" class="summary">
                <p>No hay mediciones guardadas a√∫n</p>
            </div>
            
            <!-- Acciones del lote -->
            <div class="lote-final-actions">
                <button id="btnGuardarLote" class="btn btn-info">
                    üíæ Guardar Lote
                </button>
                <button id="btnExportar" class="btn btn-success">
                    üì• Exportar Lote Actual
                </button>
                <button id="btnLimpiar" class="btn btn-danger">
                    üóëÔ∏è Limpiar Todo
                </button>
            </div>
            
            <!-- Exportaci√≥n global -->
            <div style="margin-top: 15px;">
                <button id="btnExportarTodo" class="btn btn-warning" style="width: 100%;">
                    üìä Exportar TODOS los Lotes (Global)
                </button>
                <small style="display: block; text-align: center; margin-top: 5px; color: #757575;">
                    Descarga un solo CSV con todos los lotes medidos
                </small>
            </div>
        </div>

        <!-- Modal de calibraci√≥n -->
        <div id="modalCalibracion" class="modal" style="display:none;">
            <div class="modal-content">
                <h3>üéØ Calibraci√≥n</h3>
                <p>1. Posici√≥nese a <strong id="distanciaCalibracion">15</strong> metros del √°rbol</p>
                <p>2. Apunte la c√°mara a la BASE del √°rbol</p>
                <p>3. Presione "Establecer Cero" cuando est√© listo</p>
                <button id="btnEstablecerCero" class="btn btn-primary">
                    Establecer Cero
                </button>
                <button id="btnCancelarCalibracion" class="btn btn-secondary">
                    Cancelar
                </button>
            </div>
        </div>

        <!-- Estado de guardado -->
        <div id="estadoGuardado" class="save-status">
            Guardado autom√°tico activo
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>